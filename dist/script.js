var production,legend;function renderPie(t){var e=Math.min(450,450)/2-40;d3.select("#pie-share").select("svg").remove();var o=d3.select("#pie-share").append("svg").attr("width",450).attr("height",450).append("g").attr("transform","translate(225,225)"),n={nuclear:parseFloat(production[t].nuclear),fossil:parseFloat(production[t].fossil),gas:parseFloat(production[t].gas),oil:parseFloat(production[t].oil),renewable:parseFloat(production[t].renewable),other:parseFloat(production[t].other)},r=d3.scaleOrdinal().domain(n).range(["yellow"]),a=d3.pie().value(function(t){return t.value})(d3.entries(n)),d=d3.arc().innerRadius(0).outerRadius(e);o.selectAll("mySlices").data(a).enter().append("path").attr("d",d).style("fill",function(t){return console.log(t.data.key),r(t.data.key)}).attr("stroke","black").style("stroke-width","2px").style("opacity",.7),o.selectAll("mySlices").data(a).enter().append("text").text(function(t){return"grp "+t.data.key}).attr("transform",function(t){return"translate("+d.centroid(t)+")"}).style("text-anchor","middle").style("font-size",17)}function showCountry(){$(".svg").load($(".svg").data("file"),function(){$("path.eu").click(function(){var t;console.log($(this)),console.log($(this).attr("id")),$(this).hasClass("selected")?($(this).removeClass("selected"),t="eu"):($("path.eu").removeClass("selected"),$(this).addClass("selected"),t=$(this).attr("id")),window.history.replaceState("",document.title,window.location.href.replace(location.hash,"")+t),$("#country-title").html(production[t].name),$("#nav-country .flag").attr("src","img/flags/"+t+".svg");var e=$("<td>"+production[t][2007]+"</td>"),o=$("<td>"+production[t][2017]+"</td>"),n=$("<tr></tr>").append(e,o);$("#table-years tbody").html(n);var r=$("<td>"+production[t].nuclear+"</td>"),a=$("<td>"+production[t].fossil+"</td>"),d=$("<td>"+production[t].gas+"</td>"),i=$("<td>"+production[t].oil+"</td>"),l=$("<td>"+production[t].renewable+"</td>"),s=$("<td>"+production[t].other+"</td>"),c=$("<tr></tr>").append(r,a,d,i,l,s);$("#table-share tbody").html(c),renderPie(t)})})}function showData(){$.each(production,function(t){var e=$("<img src='img/flags/"+t+".svg' alt='"+production[t].name+"' class='flag'>"),o=$("<td></td>").append(e," ",production[t].name),n=$("<td>"+production[t][2007]+"</td>"),r=$("<td>"+production[t][2017]+"</td>"),a=$("<td>"+production[t].nuclear+"</td>"),d=$("<td>"+production[t].fossil+"</td>"),i=$("<td>"+production[t].gas+"</td>"),l=$("<td>"+production[t].oil+"</td>"),s=$("<td>"+production[t].renewable+"</td>"),c=$("<td>"+production[t].other+"</td>"),u=$("<tr></tr>").append(o,n,r,a,d,i,l,s,c);"eu"===t?$("#table-production tfoot").append(u):$("#table-production tbody").append(u)})}function run(){$(document).ready(function(){console.log(production),showCountry(),showData(),$("#cz").tooltip({title:"This will show in absence of title attribute."}),$("#cz").tooltip("show")})}$.getJSON("data/numbers.json",function(t){legend=t.legend,production=t.production}).done(function(){run()}).fail(function(){console.log("error")});